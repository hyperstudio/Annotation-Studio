/*
** Annotator v1.2.5
** https://github.com/okfn/annotator/
**
** Copyright 2012 Aron Carroll, Rufus Pollock, and Nick Stenning.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2012-06-22 12:25:27Z
*/((function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Annotator.Plugin.AnnotateItPermissions=function(b){function e(){this._setAuthFromToken=a(this._setAuthFromToken,this),this.updateAnnotationPermissions=a(this.updateAnnotationPermissions,this),this.updatePermissionsField=a(this.updatePermissionsField,this),this.addFieldsToAnnotation=a(this.addFieldsToAnnotation,this),e.__super__.constructor.apply(this,arguments)}return c(e,b),e.prototype.options={showViewPermissionsCheckbox:!0,showEditPermissionsCheckbox:!0,groups:{world:"group:__world__",authenticated:"group:__authenticated__",consumer:"group:__consumer__"},userId:function(a){return a.userId},userString:function(a){return a.userId},userAuthorize:function(a,b,c){var e,f,g,h,i,j;f=b.permissions||{},e=f[a]||[];if(g=this.groups.world,d.call(e,g)>=0)return!0;if(c!=null&&c.userId!=null&&c.consumerKey!=null)return c.userId===b.user&&c.consumerKey===b.consumer?!0:(h=this.groups.authenticated,d.call(e,h)>=0)?!0:c.consumerKey===b.consumer&&(i=this.groups.consumer,d.call(e,i)>=0)?!0:c.consumerKey===b.consumer&&(j=c.userId,d.call(e,j)>=0)?!0:c.consumerKey===b.consumer&&c.admin?!0:!1},permissions:{read:["group:__world__"],update:[],"delete":[],admin:[]}},e.prototype.addFieldsToAnnotation=function(a){e.__super__.addFieldsToAnnotation.apply(this,arguments);if(a&&this.user)return a.consumer=this.user.consumerKey},e.prototype.updatePermissionsField=function(a,b,c){var d;return b=$(b).show(),d=b.find("input").removeAttr("disabled"),this.authorize("admin",c)||b.hide(),this.user&&this.authorize(a,c||{},{userId:"__nonexistentuser__",consumerKey:this.user.consumerKey})?d.attr("checked","checked"):d.removeAttr("checked")},e.prototype.updateAnnotationPermissions=function(a,b,c){var d;return c.permissions||(c.permissions=this.options.permissions),d=a+"-permissions",$(b).find("input").is(":checked")?c.permissions[a]=[a==="read"?this.options.groups.world:this.options.groups.consumer]:c.permissions[a]=[]},e.prototype._setAuthFromToken=function(a){return this.setUser(a)},e}(Annotator.Plugin.Permissions)})).call(this);